- path: ${NODE_SCRIPTS_PATH}/installCardanoBinaries.sh
  permissions: "550"
  content: |
    #!/bin/bash

    CONFIG_BUILD=$1
    BINARY_BUILD=$2
    VERSION=3

    if [ -z "$1" ] || [ -z "$2" ] || [ -z "$3" ]; then 
      return 
    fi

    wget -N https://hydra.iohk.io/build/$BINARY_BUILD/download/1/cardano-node-$VERSION-linux.tar.gz -P /tmp

    mkdir /tmp/binaries-$VERSION

    tar -C /tmp/binaries-$VERSION -zxvf /tmp/cardano-node-$VERSION-linux.tar.gz

    rm /tmp/cardano-node-$VERSION-linux.tar.gz

    mv /usr/local/bin/cardano-node /usr/local/bin/cardano-node.backup
    mv /usr/local/bin/cardano-cli /usr/local/bin/cardano-cli.backup

    cp /tmp/binaries-$VERSION/cardano-node /usr/local/bin/cardano-node
    cp /tmp/binaries-$VERSION/cardano-cli /usr/local/bin/cardano-cli

    chmod +x /usr/local/bin/cardano-node
    chmod +x /usr/local/bin/cardano-cli

    chown cardano:cardano /usr/local/bin/cardano-node
    chown cardano:cardano /usr/local/bin/cardano-cli

    ## Clean up
    rm -rf /tmp/binaries-$VERSION

    buildPath=https://hydra.iohk.io/build/$CONFIG_BUILD/download/1/${NODE_NETWORK}
    wget -O ${NODE_CONFIG_PATH}/${NODE_NETWORK}-byron-genesis.json $buildPath-byron-genesis.json
    wget -O ${NODE_CONFIG_PATH}/${NODE_NETWORK}-topology.json $buildPath-topology.json
    wget -O ${NODE_CONFIG_PATH}/${NODE_NETWORK}-shelley-genesis.json $buildPath-shelley-genesis.json
    wget -O ${NODE_CONFIG_PATH}/${NODE_NETWORK}-alonzo-genesis.json $buildPath-alonzo-genesis.json
    wget -O ${NODE_CONFIG_PATH}/${NODE_NETWORK}-config.json $buildPath-config.json
